<!doctype html><html lang=es-mx><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Joshua Haase</title>
<link rel=stylesheet media=screen href=https://joshua.haase.mx/css/theme.min.2ee1317322f9eb9b2ef0a618d19b20e38c11f5f9c310751400a45db225dd2626.css integrity="sha256-LuExcyL565su8KYY0Zsg44wR9fnDEHUUAKRdsiXdJiY="></head><body><main><article><nav id=TableOfContents><ul><li><a href=#lecciones-aprendidas-del-primer-capture-the-flag-que-hice>Lecciones aprendidas del primer <em>Capture the Flag</em> que hice</a></li><li><a href=#dise√±ando-los-juegos-para-el-aprendizaje>Dise√±ando los juegos para el aprendizaje</a></li><li><a href=#desactivar-medidas-de-seguridad>Desactivar medidas de seguridad</a></li><li><a href=#c√≥mo-se-protegen-los-programas>C√≥mo se protegen los programas</a></li><li><a href=#c√≥mo-demostrar-programas-vulnerables>C√≥mo demostrar programas vulnerables</a></li><li><a href=#ejecutar-programas-desde-la-pila>Ejecutar programas desde la pila</a></li><li><a href=#c√≥mo-aprovechar-la-vulnerabilidad-de-los-programas-para-ejecutar-c√≥digo-arbitrario>C√≥mo aprovechar la vulnerabilidad de los programas para ejecutar c√≥digo arbitrario</a></li><li><a href=#c√≥mo-atacar-la-memoria-cu√°ndo-est√°-protegida>C√≥mo atacar la memoria cu√°ndo est√° protegida</a></li><li><a href=#c√≥mo-evitar-que-se-diagnostiquen-los-programas>C√≥mo evitar que se diagnostiquen los programas</a></li><li><a href=#herramientas-para-programar-con-c√≥digo-existente>Herramientas para programar con c√≥digo existente</a></li><li><a href=#minimizar-el-tama√±o-de-los-ctf>Minimizar el tama√±o de los CTF</a></li></ul><ul><li><a href=#restringir-permisos-de-usuario-compartido-en-servidor>Restringir permisos de usuario compartido en servidor</a></li><li><a href=#generar-sitio-privado-para-documentaci√≥n-de-estudiantes>Generar sitio privado para documentaci√≥n de estudiantes</a></li></ul><ul><li><a href=#generar-sitio-de-documentaci√≥n-para-taller-de-ciberseguridad>Generar sitio de documentaci√≥n para taller de ciberseguridad</a></li><li><a href=#-c√≥mo-compartir-control-en-aplicaciones-gr√°ficas>‚òë C√≥mo compartir control en aplicaciones gr√°ficas</a></li><li><a href=#problemas-con-xpra>Problemas con xpra</a></li><li><a href=#herramientas-para-visualizar-la-memoria-urlhttpsstackoverflowcomquestions5752605tool-to-clearly-visualize-memory-layout-of-a-c-program>Herramientas para visualizar la memoria [@url:https://stackoverflow.com/questions/5752605/tool-to-clearly-visualize-memory-layout-of-a-c-program]</a></li><li><a href=#dirigir-el-entrenamiento-hacia-binarios-y-c√≥mo-funcionan-las-computadoras>Dirigir el entrenamiento hacia binarios y c√≥mo funcionan las computadoras</a></li></ul></nav><p>La metodolog√≠a para el dise√±o de los retos se utiliz√≥ para el
<a href=https://preuniversitarios.ibero.mx/CSAW/ target=_blank rel=noopener>Cyber Security Challenge for High School</a>.</p><p>Se encontr√≥ que implementaci√≥n t√©cnica de los juegos
puede afectar el objetivo de aprendizaje:</p><ul><li>Pueden existir atajos para resolver los juegos.</li></ul><h2 id=lecciones-aprendidas-del-primer-capture-the-flag-que-hice><a href=#lecciones-aprendidas-del-primer-capture-the-flag-que-hice alt>Lecciones aprendidas del primer <em>Capture the Flag</em> que hice</a> <a href=# alt="Regresar al inicio">‚Üë</a></h2><ol><li><p>Si se va a publicar el binario para permitir pruebas locales,
es muy <strong>importante separar las banderas del binario</strong>,
o cambiarlas en el binario publicado.</p><p>No hacer esto puede eliminar el aprendizaje en el juego,
porque cualquiera abre un block de notas o usa <code>strings</code>.</p><p>De igual manera,
le√≠ que se recomienda no usar un indicativo
que haga evidente las banderas como <code>\flag{}</code>
porque la gente podr√≠a usar <code>grep</code>.</p></li><li><p>Para simplificar los retos
conviene <a href=./aplicaciones-vulnerables-para-poc/>desactivar las opciones de seguridad del compilador</a>
y eliminar las optimizaciones del c√≥digo.</p><pre tabindex=0><code>CFLAGS=-fno-stack-protector -no-pie -ggdb3 -O0
</code></pre></li><li><p>Al intentar explotar <a href>un binario con protecciones desactivadas</a>,
se puede quedar el programa colgado y utilizando el m√°ximo de los recursos.
Por lo tanto conviene limitar la ejecuci√≥n del c√≥digo.</p><pre tabindex=0><code>prlimit -t=${TIEMPO_RAZONABLE_PARA_EJECUTAR} aplicaci√≥n
</code></pre><p>(Tengo entendido que este es tiempo efectivo de ejecuci√≥n
y no hay problema si el programa est√° esperando input;
no he puesto a prueba esta hip√≥tesis.)</p></li><li><p>Las aplicaciones usan un buffer para imprimir en <code>stdout</code>.
Si la aplicaci√≥n no limpia el buffer al enviar la bandera,
puede que el jugador resuelva correctamente pero no obtenga la bandera.</p></li></ol><h2 id=dise√±ando-los-juegos-para-el-aprendizaje><a href=#dise%c3%b1ando-los-juegos-para-el-aprendizaje alt>Dise√±ando los juegos para el aprendizaje</a> <a href=# alt="Regresar al inicio">‚Üë</a></h2><p>Algo que me encanta de plataformas de juegos como [Over The Wire](<a href=https://overthewire.org/ target=_blank rel=noopener>https://overthewire.org/</a> &ldquo;The wargames OverTheWire can help you to learn and practice security concepts in the form of fun-filled games.&rdquo;
(puedes empezar por <a href=https://overthewire.org/wargames/bandit/ title="War Games over the Wire" target=_blank rel=noopener>bandit</a>)
es que plantea retos para que aprendas haciendo
y te ofrece las pistas suficientes para que vayas aprendiendo
a usar tu computadora m√°s all√° del <em>point and click</em>.</p><p>En el caso del segundo juego ¬´natas¬ª,
cuando lo intent√© con el <a href=/csaw/ title="Yo quer√≠a llamarlo Taller del Hacker √âtico.">taller de ciberseguridad</a>
mis alumnos han tenido problemas porque en algunos casos la dificultad
salta de un problema s√∫per sencillo a el nivel m√°s alto de exploraci√≥n del problema.</p><p>Y aunque es divertido para un hacker que ya tiene algo de experiencia
y al menos tiene una noci√≥n de qu√© hay que hacer,
es frustrante pasar sesione explorando sin avance aparente.</p><p>Entonces he querido <a href=/techno/aplicaciones-vulnerables-para-poc/ title="Mis notas para hacer aplicaciones vulnerables">hacer un camino de victorias intermedias</a>
para aprender los conceptos desde una perspectiva pr√°ctica,
<a href=/techno/aplicacines-vulnerables-para-poc/ title="Mis notas acerca de qu√© tomar en cuenta cu√°ndo haces retos de CTF.">con ayudas en el camino</a>.</p><h2 id=desactivar-medidas-de-seguridad><a href=#desactivar-medidas-de-seguridad alt>Desactivar medidas de seguridad</a> <a href=# alt="Regresar al inicio">‚Üë</a></h2><p>La mayor√≠a de las vulnerabilidades en los programas son errores de gesti√≥n de memoria.</p><p>Para ense√±ar c√≥mo funcionan los ataques de desbordamiento de la pila,
es importante entender <a href=https://www.geeksforgeeks.org/memory-layout-of-c-program/ target=_blank rel=noopener>c√≥mo guardan informaci√≥n los programas</a>.</p><p><a href=https://www.eecs.umich.edu/courses/eecs588/static/stack_smashing.pdf target=_blank rel=noopener>¬´Smashing the stack for fun and profit¬ª</a>
explica relativamente bien c√≥mo funciona todo.</p><p><a href=https://web.archive.org/web/20060919233718/https://inst.eecs.berkeley.edu/~cs164/sp05/ia32-refs/ia32-chapter-three.pdf target=_blank rel=noopener>C√≥mo funciona la pila en ia32</a>..</p><p><a href=https://eli.thegreenplace.net/2011/09/06/stack-frame-layout-on-x86-64 target=_blank rel=noopener>C√≥mo funciona la pila en x86_64</a>.</p><p><a href=https://courses.cs.washington.edu/courses/cse351/18wi/lectures/10/CSE351-L10-x86-III_18wi.pdf target=_blank rel=noopener>M√°s acerca de como funciona el stack en x86-64</a>.</p><h2 id=c√≥mo-se-protegen-los-programas><a href=#c%c3%b3mo-se-protegen-los-programas alt>C√≥mo se protegen los programas</a> <a href=# alt="Regresar al inicio">‚Üë</a></h2><p>Al compilar los programas se pueden activar varias opciones de protecci√≥n.</p><p><a href=https://mcuoneclipse.com/2019/09/28/stack-canaries-with-gcc-checking-for-stack-overflow-at-runtime/ title="As√≠ funcionan los Canarios de la Pila." target=_blank rel=noopener><code>-stack-protection</code></a>: verifica que las variables se escriban en su lugar.</p><p><code>-pie</code>: genera c√≥digo que puede moverse en la memoria.</p><p><code>-s</code>: elimina (strips) los s√≠mbolos de depuraci√≥n.</p><p><code>---noexecstack</code>: marca la memoria escribible como no ejecutable (DEP)</p><p>Se pueden revisar opciones de seguridad de los binarios usando:</p><pre tabindex=0><code>checksec --file=${EJECUTABLE}
checksec --directory=${EJECUTABLE}
</code></pre><p><a href=https://wiki.debian.org/Hardening target=_blank rel=noopener>Gu√≠a de Debian para proteger los programas</a>.</p><h2 id=c√≥mo-demostrar-programas-vulnerables><a href=#c%c3%b3mo-demostrar-programas-vulnerables alt>C√≥mo demostrar programas vulnerables</a> <a href=# alt="Regresar al inicio">‚Üë</a></h2><p>Para aprender los b√°sicos acerca de c√≥mo atacar programas,
conviene <a href=https://stackoverflow.com/questions/2340259/how-to-turn-off-gcc-compiler-optimization-to-enable-buffer-overflow target=_blank rel=noopener>deshabilitar las funciones de seguridad en la compilaci√≥n de los programas</a>,
<a href=https://reverseengineering.stackexchange.com/a/27682 target=_blank rel=noopener>incluyendo RELRO</a>.</p><pre tabindex=0><code>gcc \
    -fno-stack-protector \
    -no-pie \
    -Wl,-z,norelro,execstack \
    -o ${PROGRAM} \
    ${SOURCE}
</code></pre><p>En varios sitios recomiendan adem√°s <a href=https://0x10f8.wordpress.com/2019/05/21/subverting-nx-bit-with-return-to-libc/ target=_blank rel=noopener>desactivar ASLR en la configuraci√≥n del kernel</a>:</p><pre tabindex=0><code># echo 0 &gt; /proc/sys/kernel/randomize_va_space
</code></pre><p>Sobrescribir la pila,
permite controlar el flujo de ejecuci√≥n del programa
porque <a href=http://theamazingking.com/tut2.php target=_blank rel=noopener>en la pila se guardan los punteros para continuar la ejecuci√≥n del programa</a>.</p><h2 id=ejecutar-programas-desde-la-pila><a href=#ejecutar-programas-desde-la-pila alt>Ejecutar programas desde la pila</a> <a href=# alt="Regresar al inicio">‚Üë</a></h2><p>En la mayor√≠a de los casos los sistemas operativos actualizados
impiden la ejecuci√≥n de c√≥digo en la pila
aunque <a href=https://stackoverflow.com/a/3756315/10467443 target=_blank rel=noopener>es posible que algunos dispositivos embebidos a√∫n contengan esta vulnerabilidad</a></p><p><a href=https://stackoverflow.com/a/3755573/10467443 target=_blank rel=noopener>Esta respuesta de Stack Overflow</a>
lista algunos punteros para desactivar las protecciones:</p><blockquote><p>&ldquo;- Disable stack protection at the OS level.</p><ul><li>Allow execution from the stack on a particular executable file.</li><li>mprotect() the stack.</li><li>Maybe some other things&mldr;&rdquo;</li></ul></blockquote><p>Esta medida de seguridad es dif√≠cil de desactivar
porque <a href=https://security.stackexchange.com/a/230816/274242 target=_blank rel=noopener>se tiene que desactivar en todo el sistema operativo
y no puede desactivarse √∫nicamente para un programa
o dentro de un contenedor</a>.</p><p>Por lo tanto, para montar estos juegos,
estoy considerando usar alguna m√°quina virtual ultra ligera:</p><ul><li><p>Alpine sobre <code>QEMU</code>:</p><p>Sospecho que esta va a ser la forma m√°s sencilla de levantar un servicio
que tenga desactivado ASLR.</p></li><li><p><a href=https://github.com/miklevin/Levinux title="Sistema operativo que se ejecuta en RAM y tiene mensajes para aprendizaje" target=_blank rel=noopener>Levinux</a>:</p><p>Me llam√≥ la atenci√≥n porque
funciona en los 3 sistemas operativos mayoritarios
tiene un perspectiva educativa
y al parecer algunos tutoriales.
<a href=https://web.archive.org/web/20220518140233/https://mikelev.in/2011/08/virtual-machine-runs-anywhere/ title="Aunque probablemente use alpine sobre QEMU de todas formas." target=_blank rel=noopener>Aqu√≠ est√° un post acerca de c√≥mo se hizo Levinux</a>.
Al final es un <code>QEMU</code>.</p></li></ul><h2 id=c√≥mo-aprovechar-la-vulnerabilidad-de-los-programas-para-ejecutar-c√≥digo-arbitrario><a href=#c%c3%b3mo-aprovechar-la-vulnerabilidad-de-los-programas-para-ejecutar-c%c3%b3digo-arbitrario alt>C√≥mo aprovechar la vulnerabilidad de los programas para ejecutar c√≥digo arbitrario</a> <a href=# alt="Regresar al inicio">‚Üë</a></h2><p>Si tienes suficiente espacio en un programa vulnerable,
puedes escribir una funci√≥n arbitraria en la memoria del programa.</p><p>Hay <a href=http://shell-storm.org/shellcode/ target=_blank rel=noopener>inventarios de funciones en ensamblador para ataques de overflow</a></p><p>En caso contrario, <a href=https://insecure.org/stf/smashstack.html target=_blank rel=noopener>puedes escribir el c√≥digo en el entorno
y apuntar el puntero de retorno a tu c√≥digo</a>.</p><h2 id=c√≥mo-atacar-la-memoria-cu√°ndo-est√°-protegida><a href=#c%c3%b3mo-atacar-la-memoria-cu%c3%a1ndo-est%c3%a1-protegida alt>C√≥mo atacar la memoria cu√°ndo est√° protegida</a> <a href=# alt="Regresar al inicio">‚Üë</a></h2><p>Se puede utilizar el c√≥digo que ya est√° en memoria para construir programas arbitrarios,
eso se conoce como <a href=https://en.wikipedia.org/wiki/Return-oriented_programming target=_blank rel=noopener>return-oriented programming (ROP)</a>
y <a href=https://seclists.org/bugtraq/1997/Aug/63 target=_blank rel=noopener>este es uno de los primeros ejemplos</a>.</p><p><a href=http://shell-storm.org/talks/ROP_course_lecture_jonathan_salwan_2014.pdf target=_blank rel=noopener>Se pueden generar ataques elaborados con las instrucciones en memoria</a>.</p><p><a href=https://github.com/JonathanSalwan/ROPgadget/tree/master target=_blank rel=noopener>Esta herramienta busca c√≥digo disponible para construir tus programas</a>.</p><h2 id=c√≥mo-evitar-que-se-diagnostiquen-los-programas><a href=#c%c3%b3mo-evitar-que-se-diagnostiquen-los-programas alt>C√≥mo evitar que se diagnostiquen los programas</a> <a href=# alt="Regresar al inicio">‚Üë</a></h2><p><a href=http://shell-storm.org/blog/Linux-process-execution-and-the-useless-ELF-header-fields/ target=_blank rel=noopener>Eliminar los campos de ELF que no se usan para ejecutar impide su depuraci√≥n</a>
y <a href=http://shell-storm.org/blog/Linux-process-execution-and-the-useless-ELF-header-fields/anti-debug.c target=_blank rel=noopener>aqu√≠ hay c√≥digo para hacerlo</a>.</p><p>Tambi√©n <a href=http://shell-storm.org/blog/Polymorphism-and-Return-Oriented-Programming/ target=_blank rel=noopener>se puede alterar un programa por otro funcionalmente equivalente
que no contenga la parte com√∫n de los exploits</a>.</p><p><a href=https://stackoverflow.com/questions/5752605/tool-to-clearly-visualize-memory-layout-of-a-c-program target=_blank rel=noopener>Herramientas para visualizar la memoria</a>:</p><ul><li><a href=https://www.cs.kent.ac.uk/projects/gc/gcspy/ target=_blank rel=noopener>GCspy</a></li><li><a href=http://www.cs.kent.edu/~jmaletic/cs69995-PC/papers/Moreta07.pdf target=_blank rel=noopener>Paper de visualizaci√≥n donde no se muestra ni se hace referencia al c√≥digo</a></li></ul><h2 id=herramientas-para-programar-con-c√≥digo-existente><a href=#herramientas-para-programar-con-c%c3%b3digo-existente alt>Herramientas para programar con c√≥digo existente</a> <a href=# alt="Regresar al inicio">‚Üë</a></h2><p><a href=https://triton.quarkslab.com/ target=_blank rel=noopener>An√°lisis din√°mico de binarios</a></p><p><a href=http://shell-storm.org/project/ROPgadget/ target=_blank rel=noopener>http://shell-storm.org/project/ROPgadget/</a></p><p>La idea es usar c√≥digo que contiene funciones que retornan,
porque se pueden encadenar para alcanzar cualquier objetivo.</p><p>Esto se conoce como <strong>Return Oriented Programming</strong>.
Tiene las ventajas de que se salta todas las protecciones conocidas de la pila
y puede mitigarse <a href=https://lwn.net/Articles/870045/ target=_blank rel=noopener>borrando los registros antes de retornar</a>,
<a href=https://www.jerkeby.se/newsletter/posts/rop-reduction-zero-call-user-regs/ target=_blank rel=noopener>introduciendo 13% JOP gadgets y reduciendo 36% ROP gadgets para Linux</a>.</p><p>Sin embargo, <a href=https://dustri.org/b/paper-notes-clean-the-scratch-registers-a-way-to-mitigate-return-oriented-programming-attacks.html target=_blank rel=noopener>borrar los registros podr√≠a deteriorar el rendimiento</a>
presumiblemente sin agregar a la seguridad.</p><p><a href=https://www.jerkeby.se/newsletter/posts/history-of-rop/ target=_blank rel=noopener>https://www.jerkeby.se/newsletter/posts/history-of-rop/</a></p><p><a href=https://stackoverflow.com/questions/1345670/stack-smashing-detected#comment37057047_1347464 target=_blank rel=noopener>Un consejo terrible: desactivar la protecci√≥n anti pila en producci√≥n</a>.</p><h2 id=minimizar-el-tama√±o-de-los-ctf><a href=#minimizar-el-tama%c3%b1o-de-los-ctf alt>Minimizar el tama√±o de los CTF</a> <a href=# alt="Regresar al inicio">‚Üë</a></h2><p>Las im√°genes que <code>ctfcli</code> genera por defecto
son del orden de cientos de megabytes.</p><p>Aunque el espacio en disco es actualmente lo m√°s barato en c√≥mputo
y en varios lugares es gratuito tener varios GB de datos.</p><p>Sin embargo, para probar peque√±os cambios en los juegos en un servidor,
tener que enviar cientos de MB por una peque√±a diferencia no hace sentido
y toma mucho m√°s tiempo hacer la retroalimentaci√≥n y el diagn√≥stico.</p><p>As√≠ que pens√© en hacer im√°genes m√≠nimas
que contengan √∫nicamente lo necesario para ejecutar el reto.
En algunos casos, s√≥lo se necesita en el contenedor
los programas vulnerables compilados est√°ticamente
y <a href=https://skarnet.org/software/s6 target=_blank rel=noopener>la suite de supervisi√≥n</a>.</p><p>Una manera sencilla de hacer esto es compilar los programas
y luego generar un contenedor vac√≠o que incluye:</p><ul><li>los programa necesarios</li><li>las bibliotecas que utilizan</li></ul><p>El <code>Dockerfile</code> quedar√≠a parecido a:</p><pre tabindex=0><code>FROM debian:stretch-20211011-slim as builder

WORKDIR /root

RUN apt-get update \
  &amp;&amp; apt-get -y install \
    build-essential \
  &amp;&amp; apt clean

COPY src/makefile src/game.c /root/
RUN make game

FROM alpine:3.14.2 as system

RUN apk add \
        s6-networking \
        util-linux

WORKDIR /opt

COPY --from=builder /root/game /opt/app

FROM scratch

COPY --from=system \
  /lib/ld-musl-x86_64.so.1 \
  /lib/libskarnet.so.2.10 \
  /lib/libsmartcols.so.1 \
/lib/

COPY --from=system \
  /bin/s6-applyuidgid \
  /opt/app \
  /usr/bin/s6-tcpserver \
  /usr/bin/s6-tcpserver4d \
  /usr/bin/s6-tcpserver4-socketbinder \
  /usr/bin/prlimit \
/bin/

COPY --from=builder src/game /bin/app

EXPOSE 1337

CMD [&#34;/bin/s6-tcpserver&#34;, &#34;-u&#34;, &#34;1001&#34;, &#34;-g&#34;, &#34;1001&#34;, &#34;0.0.0.0&#34;, &#34;1337&#34;, &#34;/bin/prlimit&#34;, &#34;-t=3&#34;, &#34;/bin/app&#34;]
</code></pre><p>En algunas ocasiones,
el ejercicio requiere que sea posible ejecutar una consola,
por lo que podr√≠a convenir incluir en el contenedor
<a href=https://github.com/robxu9/bash-static/ target=_blank rel=noopener>una versi√≥n est√°tica de bash</a>
como <code>/bin/sh</code>.</p><p>Se est√° trabajando adem√°s en una m√°quina virtual m√≠nima,
y un sistema para reproducirlo.</p><h1 id=implementaci√≥n-de-infraestructura-para-proyecto><a href=#implementaci%c3%b3n-de-infraestructura-para-proyecto alt>Implementaci√≥n de infraestructura para proyecto</a> <a href=# alt="Regresar al inicio">‚Üë</a></h1><h2 id=restringir-permisos-de-usuario-compartido-en-servidor><a href=#restringir-permisos-de-usuario-compartido-en-servidor alt>Restringir permisos de usuario compartido en servidor</a> <a href=# alt="Regresar al inicio">‚Üë</a></h2><p>Esta configuraci√≥n se est√° llevando a cabo en el directorio
${HOME}/src/gitlab.com/gcd-ibero/gestion-de-infraestructura
y se puede acceder a √©l con el comando <code>cd $(repo -inf)</code>.</p><ul><li><p>[‚úì] Utilizar un usuario compartido en un servidor
para que los estudiantes usen su propia compu para ejecutar los comandos.</p><ul><li>[‚úì] Generar el usuario.</li><li>[‚úì] Instalar <code>byobu</code>.</li><li>[‚úì] Generar una contrase√±a para el usuario</li></ul></li><li><p>[‚úì] Restringir los comandos que puede utilizar el usuario compartido:</p><p><a href=https://www.ibm.com/support/pages/how-use-restricted-shell title="C√≥mo usar una consola restringida" target=_blank rel=noopener>C√≥mo usar</a>
una <a href=https://www.gnu.org/software/bash/manual/html_node/The-Restricted-Shell.html target=_blank rel=noopener>consola restringida</a></p><ul><li><p>[‚úì] Asignar <code>rbash</code> como consola.</p></li><li><p>[‚úì] Generar un perfil que no puede modificarse y contiene las variables:</p><ul><li>[‚úì] <code>PATH</code></li></ul></li><li><p>[‚úì] Agregar al directorio configurado en el <code>PATH</code> los comandos:</p><ul><li>[‚úì] <code>ssh</code> para entrar al servidor de juegos</li><li>[‚úì] <code>man</code> para consultar documentaci√≥n</li><li>[‚úì] <code>apropos</code> para consultar documentaci√≥n</li><li>[‚úì] <code>info</code> para consultar documentaci√≥n</li><li>[‚úì] <code>byobu</code> para compartir la pantalla</li><li>[‚úì] <code>less</code></li><li>[‚úì] <code>nano</code></li><li>[‚úì] <code>clear</code></li><li>[‚úì] <code>tput</code></li></ul></li><li><p>[‚úì] <a href=https://bryan-murdock.blogspot.com/2010/10/how-to-disable-ubuntu-command-not-found.html target=_blank rel=noopener>Desactivar el aviso de commando no encontrado</a></p><pre tabindex=0><code>unset command_not_found_handle
</code></pre></li></ul></li></ul><h2 id=generar-sitio-privado-para-documentaci√≥n-de-estudiantes><a href=#generar-sitio-privado-para-documentaci%c3%b3n-de-estudiantes alt>Generar sitio privado para documentaci√≥n de estudiantes</a> <a href=# alt="Regresar al inicio">‚Üë</a></h2><p><code>cd $(repo -inf)/colaborative-writing</code></p><p>HedgeDoc les gust√≥ mucho a los estudiantes del taller.</p><ul><li><p>[‚úì] Generar un <code>docker-compose.yml</code> con la configuraci√≥n de
<a href=https://unix.stackexchange.com/questions/518849/how-does-one-set-up-codimd-as-a-personal-wiki target=_blank rel=noopener>CodiMD</a> o
<a href=https://docs.hedgedoc.org/setup/docker/ target=_blank rel=noopener>HedgeDoc</a></p></li><li><p>[‚úì] Configurar la instancia de <code>HedgeDoc</code> para ser privada.</p><p>¬øSe puede autenticar?
<a href=https://docs.hedgedoc.org/guides/reverse-proxy/ target=_blank rel=noopener>usando un proxy inverso</a></p><p>Se utiliz√≥ <a href=https://docs.hedgedoc.org/configuration/ target=_blank rel=noopener>la documentaci√≥n</a>
para <a href=/home/x/src/gitlab.com/gcd-ibero/gestion-de-infraestructura/colaborative-writing title="commit 1078c0">configurar la aplicaci√≥n para ser privada</a>.</p><p>Se puede agregar la opci√≥n de autorizar con:
<a href=https://docs.hedgedoc.org/guides/auth/oauth/ target=_blank rel=noopener>OAuth</a>
<a href=https://docs.hedgedoc.org/guides/auth/ldap-ad/ target=_blank rel=noopener>LDAP</a></p><p><a href=https://github.com/geerlingguy/ansible-role-certbot target=_blank rel=noopener>Se puede configurar la auto-generaci√≥n de certificados con Ansible</a></p></li><li><p>[‚úì] Configurar un proxy para que la instancia de <code>HedgeDoc</code> funcione desde un servidor remoto.</p><ul><li>Se modificaron las variables <code>CMD_DOMAIN</code> y <code>CMD_URL_ADDPORT</code>.</li></ul></li><li><p>[‚úì] Agregar un proxy <code>nginx</code> (/ge c74c771)</p></li><li><p>[‚úó] Configurar <code>certbot</code> para adquirir un certificado SSL para <code>pad.haase.mx</code>.
Usando <code>pad.lbustio.com</code> el sistema funcion√≥ correctamente.</p><ul><li><p>[‚úì] El proxy de <code>nginx</code> debe
<a href=https://docs.hedgedoc.org/guides/reverse-proxy/ target=_blank rel=noopener>generar ciertos encabezados para funcionar apropiadamente</a>
(/ge 100c31a)</p></li><li><p>[‚úó] Generar un contenedor <code>certbot</code>
y compartir la configuraci√≥n de certificados
para que <code>nginx</code> use los certificados.</p></li></ul></li><li><p>[‚úì] Configurar nuestro proxy de nginx
para redirigir el tr√°fico de <code>pad.lbustio.com</code>
desde <code>traefik</code> hacia nuestro proxy.</p><p><a href=https://doc.traefik.io/traefik/getting-started/configuration-overview/ target=_blank rel=noopener>https://doc.traefik.io/traefik/getting-started/configuration-overview/</a>
<a href=https://www.digitalocean.com/community/tutorials/how-to-use-traefik-as-a-reverse-proxy-for-docker-containers-on-ubuntu-18-04 target=_blank rel=noopener>https://www.digitalocean.com/community/tutorials/how-to-use-traefik-as-a-reverse-proxy-for-docker-containers-on-ubuntu-18-04</a></p><p><a href=https://www.digitalocean.com/community/tutorials/how-to-use-traefik-v2-as-a-reverse-proxy-for-docker-containers-on-ubuntu-20-04 target=_blank rel=noopener>https://www.digitalocean.com/community/tutorials/how-to-use-traefik-v2-as-a-reverse-proxy-for-docker-containers-on-ubuntu-20-04</a></p><pre tabindex=0><code>$ cr /ge
$ cd escritura-colaborativa
$ docker-compose --context=lbustio up -d
</code></pre><pre tabindex=0><code>$ cr /ge
$ mk pad
</code></pre><pre tabindex=0><code>$ docker-compose --context=lbustio logs proxy
Attaching to escritura-colaborativa_proxy_1
proxy_1  | /docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration
proxy_1  | /docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/
proxy_1  | /docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh
proxy_1  | 10-listen-on-ipv6-by-default.sh: info: can not modify /etc/nginx/conf.d/default.conf (read-only file system?)
proxy_1  | /docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh
proxy_1  | /docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh
proxy_1  | /docker-entrypoint.sh: Configuration complete; ready for start up
proxy_1  | 2021/08/13 22:26:17 [emerg] 1#1: unknown &#34;connection_upgrade&#34; variable
proxy_1  | nginx: [emerg] unknown &#34;connection_upgrade&#34; variable
</code></pre><p>-> Desafortunadamente, el proxy no est√° dirigiendo las aplicaciones como debe.</p><ul><li><p>üóµ Configurar <code>traefik</code> localmente.</p><p>No ser√° necesario jugar por el momento,
porque el sistema reconoci√≥ <code>pad.lbustio.com</code></p></li></ul></li><li><p>‚òë Agregar <code>pad.lbustio.com</code> al DNS.</p><p>Se le comunic√≥ a L√°zaro que hay que actualizar el DNS.</p><p>En <code>name.com</code> con el usuario lbustio.</p></li><li><p>‚òê (Opcional) Automatizar que al final de la sesi√≥n de <code>HedgeDoc</code> se agreguen a una p√°gina.</p><p>Podr√≠a usarse <a href=https://github.com/hedgedoc/cli target=_blank rel=noopener>hedgedoc/cli</a></p></li><li><p>[?] Configurar el aviso para que cambien de teclado y direcci√≥n.</p><ul><li><p><a href=https://www.systutorials.com/docs/linux/man/1-byobu/ target=_blank rel=noopener>Se pueden agregar scripts en <code>$BYOBU_CONFIG_DIR/bin/${WAIT_TIME_IN_SECONDS}_${SCRIPT_NAME}</code></a>
para que actualice el usuario al teclado y el usuario dirigiendo cada 3 minutos,
con un aviso visual o auditivo muy evidente.</p></li><li><p>[?] Hacer que inicien sesi√≥n con su nombre.
Asociar su clave p√∫blica con el nombre en byobu.</p></li><li><p>[‚úó] Entrar a la sesi√≥n restringida de <code>byobu</code>.</p><p>La sesi√≥n no restringida de byobu nos est√° funcionando relativamente bien.</p></li></ul></li><li><p>[‚úì] Levantar aplicaci√≥n <code>HedgeDoc</code> en &lt;pad.lbustio.com></p></li><li><p>‚òë Agregar usuarios en HedgeDoc.</p><p>Podr√≠an agregarse localmente los usuarios en HedgeDoc,
pero tambi√©n podr√≠a intentarse generar un SingleSignOn
con el siguiente rubro, usando <code>authelia</code>.</p><ul><li><p>Podr√≠a hacerse desde la interfaz de HedgeDoc.</p><pre tabindex=0><code>ssh lb
USER=
docker exec -ti escritura-colaborativa-app-1 bash
/hedgedoc/bin/manage_users --add ${USER}
</code></pre></li><li><p>Podr√≠a agregarse un proxy de identidad
como <a href=https://github.com/authelia/authelia/ target=_blank rel=noopener>authelia</a>.</p></li><li><p>Podr√≠a solicitar que usen una cuenta de GitLab
y utilizar el servidor de autenticaci√≥n de GitLab.</p></li></ul></li><li><p>‚òë Agregar autenticaci√≥n para acceder a la p√°gina de datos de servidor.</p><p><a href=https://mindup.medium.com/add-basic-authentication-in-docker-compose-files-with-traefik-34c781234970 target=_blank rel=noopener>Una posible opci√≥n para resolver este problema es usar <code>traefik</code></a></p><p>Parece que Renier intent√≥ instalar authelia, pero no levanta.</p><p>${HOME}/xihh/proyectos/autenticaci√≥n-de-lbustio.com</p></li><li><p>‚òë Configurar <code>traefik</code> para reenviar los encabezados de la petici√≥n completos a hedgedoc.</p></li><li><p>‚òë Grabar la sesi√≥n del taller para que la vean si faltan.</p></li><li><p>[?] <a href=https://docs.hedgedoc.org/guides/providing-terms/ target=_blank rel=noopener>Podr√≠a haber t√©rminos de uso en el pad</a>.</p></li></ul><h1 id=compartir-un-navegador-para-hacer-los-retos><a href=#compartir-un-navegador-para-hacer-los-retos alt>Compartir un navegador para hacer los retos</a> <a href=# alt="Regresar al inicio">‚Üë</a></h1><p>Se gener√≥ un contendor con un sistema operativo especializado en ciberseguridad,
que contiene las aplicacione necesarias para explorar los juegos que se proponen
y que permite compartir el control de la m√°quina para trabajar en equipo.</p><h1 id=usar-servidor-para-pr√°cticas-de-seguridad-inform√°tica><a href=#usar-servidor-para-pr%c3%a1cticas-de-seguridad-inform%c3%a1tica alt>Usar servidor para pr√°cticas de seguridad inform√°tica</a> <a href=# alt="Regresar al inicio">‚Üë</a></h1><p>Se gener√≥ un servidor que permite entregar la soluci√≥n de los retos
en un medio competitivo.</p><p>Este servidor tambi√©n permite mostrar los retos en el orden apropiado
y vincular los conocimientos con los retos.</p><h2 id=generar-sitio-de-documentaci√≥n-para-taller-de-ciberseguridad><a href=#generar-sitio-de-documentaci%c3%b3n-para-taller-de-ciberseguridad alt>Generar sitio de documentaci√≥n para taller de ciberseguridad</a> <a href=# alt="Regresar al inicio">‚Üë</a></h2><p>Una de las t√©cnicas de metacognici√≥n que trabajamos durante el taller
consiste en generar un plan de trabajo para solucionar cada uno de los juegos,
donde se identifican:</p><ul><li>Objetivo</li><li>Pasos a seguir</li><li>Inc√≥gnitas</li></ul><p>Esa herramienta se utiliza adem√°s para:</p><ul><li><p>Describir lo que se aprende en el camino,
haciendo expl√≠cito el conocimiento y ayudando a consolidarlo.</p></li><li><p>Retomar la actividad pasado un tiempo.</p></li><li><p>Introduciendo a los integrantes nuevos del equipo.</p></li></ul><h2 id=-c√≥mo-compartir-control-en-aplicaciones-gr√°ficas><a href=#-c%c3%b3mo-compartir-control-en-aplicaciones-gr%c3%a1ficas alt>‚òë C√≥mo compartir control en aplicaciones gr√°ficas</a> <a href=# alt="Regresar al inicio">‚Üë</a></h2><p>Compartir la pantalla puede hacerse con:</p><ul><li><p>VNC server/viewer</p><ul><li><p><a href=https://www.realvnc.com/en/connect/download/vnc/ target=_blank rel=noopener>Real VNC</a> (propietario)</p></li><li><p>vinagre/vino</p></li><li><p>tigervnc</p></li><li><p>wayvnc</p></li><li><p>x11vnc</p></li></ul></li><li><p><a href=http://xpra.org/ target=_blank rel=noopener>Xpra</a></p><ul><li>se puede consultar directamente desde el navegador <a href=https://github.com/Xpra-org/xpra-html5 target=_blank rel=noopener>tiene un cliente HTML5</a></li><li><a href=https://github.com/Xpra-org/xpra/blob/master/README.md target=_blank rel=noopener>funciona en cualquier plataforma</a>.</li></ul><p>Se puede iniciar desde el servidor:</p><pre tabindex=0><code>MMAP=/run/user/1000/xpra/desktop.mmap
mkdir -p ${MMAP}
PROGRAM=dwm
xpra start-desktop --max-size=1024x768 --min-size=1024x768 --desktop-scaling=off --clipboard=yes --clipboard-direction=both --mmap=${MMAP} --start ${PROGRAM}
</code></pre><p>Tambi√©n se puede iniciar de manera remota</p><pre tabindex=0><code>USER=cybersecurity
SERVER=192.168.90.11
PROGRAM=dwm
xpra start-desktop --max-size=1024x768 --min-size=1024x768 --desktop-scaling=off --clipboard=yes --clipboard-direction=both ssh://${USER}@${SERVER}/ --start ${PROGRAM}
</code></pre><p>Para usar la gui compartida:</p><pre tabindex=0><code>MMAP=/run/user/1000/xpra/desktop.mmap
USER=
SERVER=192.168.122.120
REMOTE_DISPLAY=
xpra attach ssh://${SERVER}/${REMOTE_DISPLAY} --sharing=yes --start=firefox --clipboard=yes --clipboard-direction=both --max-size=1024x768 --min-size=1024x768 --mmap=${MMAP} # no funciona
</code></pre><p>Para iniciar aplicaciones:</p><pre tabindex=0><code>APP=
USER=
SERVER=192.168.122.120
REMOTE_DISPLAY=
xpra attach --desktop-scaling=off --sharing=yes --max-size=1024x768 --min-size=1024x768 --clipboard=yes --clipboard-direction=both --start-child ${APP} ssh://${USER}@${SERVER}/${REMOTE_DISPLAY}
</code></pre><h2 id=problemas-con-xpra><a href=#problemas-con-xpra alt>Problemas con xpra</a> <a href=# alt="Regresar al inicio">‚Üë</a></h2><p>Si se usan las configuraciones de ssh, la conexi√≥n falla con el error:</p><pre tabindex=0><code>Warning: failed to connect:
 connection failed: &#39;canonicaldomains&#39;
</code></pre><p>Los men√∫es de las GUIs no permanecen abiertos como en las aplicaciones locales</p></li></ul><ul><li><p>‚òê Configurar un servicio en el servidor que pueda compartirse.</p><p><code>cr lb</code> (commit 4a717c)</p></li><li><p>‚òë Configurar un servicio en el servidor que pueda usar ssh desde red inal√°mbrica en ibero.</p><p>Configurando un proxy TCP para el servidor SSH.</p></li><li><p>[?] Configurar monitoreo para redes:</p></li></ul><h2 id=herramientas-para-visualizar-la-memoria-urlhttpsstackoverflowcomquestions5752605tool-to-clearly-visualize-memory-layout-of-a-c-program><a href=#herramientas-para-visualizar-la-memoria-urlhttpsstackoverflowcomquestions5752605tool-to-clearly-visualize-memory-layout-of-a-c-program alt>Herramientas para visualizar la memoria [@url:https://stackoverflow.com/questions/5752605/tool-to-clearly-visualize-memory-layout-of-a-c-program]</a> <a href=# alt="Regresar al inicio">‚Üë</a></h2><p>Dado que una de las regiones m√°s desarrollada de nuestro cerebro es el c√≥rtex visual,
los mecanismos de visualizaci√≥n nos permiten comunicarnos efectivamente
y transmitir ideas complejas muy r√°pidamente
cuando se utilizan representaciones visuales efectivas.</p><p>Muchos de los programas que se usan en el √°rea de ciberseguridad
muestran una representaci√≥n textual de la memoria
y de las instrucciones de los programas ejecutables.</p><p>Una de las limitantes para entender qu√© estamos haciendo
al desarrollar estas habilidades,
es que la abstracci√≥n necesaria para explorar las aplicaciones
usando herramientas con representaci√≥n textual
no facilita la introducci√≥n a estas actividades.</p><ul><li><p><a href=https://www.cs.kent.ac.uk/projects/gc/gcspy/ target=_blank rel=noopener>GCspy</a></p></li><li><p><a href=http://www.cs.kent.edu/~jmaletic/cs69995-PC/papers/Moreta07.pdf target=_blank rel=noopener>Paper de visualizaci√≥n donde no se muestra ni se hace referencia al c√≥digo</a></p></li><li><p><a href=https://qira.me/ target=_blank rel=noopener>QIRA</a></p></li><li><p><a href=https://github.com/longld/peda target=_blank rel=noopener>PEDA</a></p></li><li><p><a href=https://cutter.re/ target=_blank rel=noopener>Cutter</a></p><ul><li><p><a href=https://github.com/radareorg/iaito target=_blank rel=noopener>iaito</a></p></li><li><p><a href=https://github.com/radareorg/radare2 target=_blank rel=noopener>radare2</a></p></li><li><p><a href=https://rizin.re/ target=_blank rel=noopener>rizin</a></p></li></ul></li><li><p><a href=https://github.com/joyent/statemap target=_blank rel=noopener>statemap</a>
y <a href='https://www.youtube.com/watch?v=x3rmg33j7RA' target=_blank rel=noopener>el video con el que lo encontr√©</a></p><p>(parece que statemap requiere input de ¬´instrumentation¬ª)</p></li></ul><p><a href=https://www.ubuntupit.com/best-linux-debuggers-for-modern-software-engineers/ target=_blank rel=noopener>Varios debuggers permiten visualizar la memoria</a>:</p><ul><li><code>ddd</code></li><li><code>kgdb</code></li><li><code>ghidra</code></li><li><code>affinic-debugger</code></li></ul><p><a href=https://stackoverflow.com/questions/5344764/gui-debugger-for-c-on-linux target=_blank rel=noopener>https://stackoverflow.com/questions/5344764/gui-debugger-for-c-on-linux</a>:</p><ul><li><p><code>nemiver</code></p></li><li><p><a href=https://github.com/DataChi/memdb target=_blank rel=noopener>https://github.com/DataChi/memdb</a></p></li><li><p><a href=https://www.xmodulo.com/visualize-memory-usage-linux.html target=_blank rel=noopener>https://www.xmodulo.com/visualize-memory-usage-linux.html</a></p></li></ul><p><a href=https://github.com/eteran/edb-debugger target=_blank rel=noopener><code>edg</code> est√° inspirado en Ollydbg</a>
y tiene <a href=https://github.com/eteran/edb-debugger/wiki/Stack-View target=_blank rel=noopener>un widget para visualizar el stack <code>Stack View</code></a>.</p><h2 id=dirigir-el-entrenamiento-hacia-binarios-y-c√≥mo-funcionan-las-computadoras><a href=#dirigir-el-entrenamiento-hacia-binarios-y-c%c3%b3mo-funcionan-las-computadoras alt>Dirigir el entrenamiento hacia binarios y c√≥mo funcionan las computadoras</a> <a href=# alt="Regresar al inicio">‚Üë</a></h2><ul><li><p>√âtica</p><ul><li>Legislaci√≥n</li><li>Responsible Disclosure</li><li>Bug Bounties</li></ul></li><li><p>Ejercicios de ASM</p></li><li><p>Errores comunes en programas de C sin mitigaciones</p><ul><li>Stack Overflow</li><li>Heap Overflow</li><li>Use after free</li><li>Format String Vulnerability</li></ul></li><li><p>Ejecuci√≥n con bibliotecas din√°micas</p><p><a href=https://blog.gibson.sh/2017/11/26/creating-portable-linux-binaries/ target=_blank rel=noopener>Un art√≠culo que explica c√≥mo usar versiones portables de las bibliotecas</a></p><p><a href=https://github.com/georgy7/build-with-musl target=_blank rel=noopener>Un tutorial para construir programas vinculados est√°ticamente</a></p><p><a href=https://github.com/robxu9/bash-static/blob/master/build.sh target=_blank rel=noopener>Un script para construir bash est√°ticamente</a></p></li><li><p>Derrotar mitigaciones:</p><ul><li><p>ALSR</p><ul><li>Hacer que el programa te diga el lugar de la memoria
donde se cargan las funciones de la tabla global de ajustes (GOT).</li></ul></li><li><p>NX</p><ul><li>Escribir en la pila √∫nicamente las direccioens del c√≥digo que quieres ejecutar.</li></ul></li><li><p>Stack Canary</p><ul><li><p>Hacer que el programa te diga el c√≥digo secreto.</p><p>¬øSobreescribir cuidando mantener este c√≥digo secreto?</p></li></ul></li><li><p><a href=https://googleprojectzero.blogspot.com/2019/02/examining-pointer-authentication-on.html target=_blank rel=noopener>Pointer Autentication</a></p><ul><li>¬øFuerza bruta?</li></ul></li></ul></li><li><p>Encontrar problemas en software</p><ul><li>Fuzzers</li></ul></li><li><p>Return Oriented Programming</p><ul><li>Escribir en la pila los lugares donde est√° el c√≥digo que quieres ejecutar.</li></ul></li><li><p>Otros lenguajes de programaci√≥n</p><ul><li>eval</li></ul></li><li><p>HTTP session hijacking</p></li><li><p><a href=https://www.redeszone.net/tutoriales/seguridad/que-son-ataques-inyeccion-comandos/ target=_blank rel=noopener>Inyecci√≥n de comandos</a></p><ul><li>SQL injection</li></ul></li><li><p>Cross Site Scripting (XSS)</p><ul><li>sandbox iframes</li></ul></li><li><p>Server Side Request Forgery</p></li><li><p>WEP/WPA cracking</p></li><li><p><strong>Explorar bug bounties</strong></p></li></ul></article></main></body></html>
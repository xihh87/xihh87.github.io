<!doctype html><html lang=es-mx><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Configurar NAT con nftables</title><link rel=stylesheet media=screen href=https://joshua.haase.mx/css/theme.min.2ee1317322f9eb9b2ef0a618d19b20e38c11f5f9c310751400a45db225dd2626.css integrity="sha256-LuExcyL565su8KYY0Zsg44wR9fnDEHUUAKRdsiXdJiY="></head><body><main><article><h1>Configurar NAT con nftables</h1><nav id=TableOfContents></nav><p><code>nft</code> es la nueva generación de <code>iptables</code> de firewall para Linux basada en <code>netfilter</code>.</p><p>Para un curso que estoy haciendo me cambiaron el uso de un servidor por la configuración del firewall,
y este artículo es para recordarme lo que hice.</p><p>Es muy importante permitir la re-dirección de paquetes en el núcleo:</p><pre tabindex=0><code>$ sudo sysctl net.ipv4.ip_forward=1
$ sudo sysctl net.ipv4.conf.enp1s0.forwarding=1
</code></pre><p>Se puede verificar si es el caso con el comando</p><pre tabindex=0><code>$ sudo sysctl -a | grep forward
</code></pre><p>En <code>nft v0.9.3</code> no se permiten las redirecciones en <code>inet</code>,
y tienen que aplicarse en las familias <code>ip</code> e <code>ipv6</code>.</p><p>La configuración que funcionó para redirigir los servicios es,
hay que cambiar la IP <code>10.0.0.1</code> por tu dirección:</p><pre tabindex=0><code>table ip nat {
        chain pre {
                type nat hook prerouting priority -100; policy accept;
                tcp dport { http, https } dnat to 10.0.0.1
        }

        chain post {
                type nat hook postrouting priority 100; policy accept;
                ip daddr 10.0.0.01 masquerade
        }
}
</code></pre></article></main></body></html>
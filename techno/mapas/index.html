<!doctype html><html lang=es-mx><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Herramientas para trabajar mapas en R</title><link rel=stylesheet media=screen href=https://joshua.haase.mx/css/theme.min.2ee1317322f9eb9b2ef0a618d19b20e38c11f5f9c310751400a45db225dd2626.css integrity="sha256-LuExcyL565su8KYY0Zsg44wR9fnDEHUUAKRdsiXdJiY="><script src=https://hypothes.is/embed.js></script></head><body><main><article><h1>Herramientas para trabajar mapas en R</h1><nav id=TableOfContents><ul><li><a href=#alternativa>Alternativa</a></li><li><a href=#se-descomprime-el-rds>Se descomprime el RDS:</a></li><li><a href=#abrir-shapefiles>Abrir shapefiles</a></li><li><a href=#paquete-para-hacer-mapas-de-méxico>Paquete para hacer mapas de México:</a></li><li><a href=#fuentes-de-información>Fuentes de información</a></li><li><a href=#más-alternativa-para-hacer-mapas>Más alternativa para hacer mapas</a></li><li><a href=#getting-polygons-of-all-countries-and-iso-3166-2-subdivisions-original>Getting polygons of all countries and ISO-3166-2 subdivisions (<a href=https://www.stackoverlflow.com/questions/23028/getting-polygons-of-all-countries-and-iso-3166-2-subdivisons>original</a>)</a></li></ul></nav><h2 id=alternativa><a href=#alternativa alt>Alternativa</a> <a href=# alt="Regresar al inicio">↑</a></h2><p>Código para generar un mapa en R: ./techno.nomia.mx/mapas.R</p><p>Se puede obtener información de OSM.</p><p><a href=https://github.com/laem/regions-topojson target=_blank rel=noopener>https://github.com/laem/regions-topojson</a></p><p><a href=https://gis.stackexchange.com/questions/23028/getting-polygons-of-all-countries-and-iso-3166-2-subdivisons/73088#73088 target=_blank rel=noopener>https://gis.stackexchange.com/questions/23028/getting-polygons-of-all-countries-and-iso-3166-2-subdivisons/73088#73088</a></p><p>Hay datos georeferenciados de las fronteras en la página:
<a href=http://www.gadm.org/download target=_blank rel=noopener>http://www.gadm.org/download</a></p><p>México:</p><p><a href=http://biogeo.ucdavis.edu/data/gadm2.8/rds/MEX_adm2.rds target=_blank rel=noopener>http://biogeo.ucdavis.edu/data/gadm2.8/rds/MEX_adm2.rds</a></p><h2 id=se-descomprime-el-rds><a href=#se-descomprime-el-rds alt>Se descomprime el RDS:</a> <a href=# alt="Regresar al inicio">↑</a></h2><pre tabindex=0><code>map &lt;- readRDS(&#34;/home/joshpar/web/biogeo.ucdavis.edu/data/gadm2.8/rds/MEX_adm2.rds&#34;)
</code></pre><p>Los <a href=http://www.statoids.com/ihasc.html target=_blank rel=noopener>códigos HASC</a> son distintos de los ISO 3166-1</p><h2 id=abrir-shapefiles><a href=#abrir-shapefiles alt>Abrir shapefiles</a> <a href=# alt="Regresar al inicio">↑</a></h2><p><a href=https://girlsrcoding.wordpress.com/2017/01/17/abrir-shapefile-en-r/ target=_blank rel=noopener>Se recomienda <code>rgdal</code></a>
(<a href=https://opensciencelabs.org/blog/dibuja-tus-mapas-en-r-usando-archivos-de-formato-shapefile/ target=_blank rel=noopener>ejemplo</a>, <a href=https://signatura21.wordpress.com/2016/09/07/cargar-un-shp-y-acceder-a-los-spatialpointsdataframe-con-r/ target=_blank rel=noopener>otro</a>).</p><p><a href=https://rpubs.com/lpenuelam/660563 target=_blank rel=noopener>Ejemplo usando <code>sf</code></a>.</p><p><a href=https://ichi.pro/es/incompatible-el-problema-de-crear-un-archivo-shapefile-de-devolucion-de-precinto-nacional-277174168059796 target=_blank rel=noopener>Como hacer un mapa de precinto nacional</a>.</p><h2 id=paquete-para-hacer-mapas-de-méxico><a href=#paquete-para-hacer-mapas-de-m%c3%a9xico alt>Paquete para hacer mapas de México:</a> <a href=# alt="Regresar al inicio">↑</a></h2><p>Para hacer mapas de México <a href=https://www.diegovalle.net/mxmaps/ target=_blank rel=noopener>se puede utilizar el paquete <code>mxmaps</code></a>,
que está <a href=https://cran.r-project.org/web/packages/choroplethr/index.html target=_blank rel=noopener>basado en choroplethr</a>
(<a href=https://cran.r-project.org/web/packages/choroplethr/choroplethr.pdf target=_blank rel=noopener>docs</a>,
<a href=https://arilamstein.com/open-source/ target=_blank rel=noopener>web</a>)
con una API simplificada.</p><pre tabindex=0><code>if (!require(&#34;devtools&#34;)) {
    install.packages(&#34;devtools&#34;)
}
devtools::install_github(&#34;diegovalle/mxmaps&#34;)
</code></pre><p>El dataframe debe contener <code>region</code> y <code>value</code>,
donde la región utiliza los códigos del INEGI.</p><p>Se pueden dibujar puntos encima utilizando <code>long</code>, <code>lat</code>.</p><p>En Google Maps, para encontrar los lugares, escribir <code>latitud,longitud</code>.</p><h2 id=fuentes-de-información><a href=#fuentes-de-informaci%c3%b3n alt>Fuentes de información</a> <a href=# alt="Regresar al inicio">↑</a></h2><p><a href=http://www.diva-gis.org/Data target=_blank rel=noopener>http://www.diva-gis.org/Data</a></p><h2 id=más-alternativa-para-hacer-mapas><a href=#m%c3%a1s-alternativa-para-hacer-mapas alt>Más alternativa para hacer mapas</a> <a href=# alt="Regresar al inicio">↑</a></h2><ul><li>Plotly <a href=https://plotly.com/python/choropleth-maps/ target=_blank rel=noopener>tiene un API para hacer mapas de colores (choropleth)</a>.</li><li>Si tienes el polígono en coordenadas de GPS,
<a href=https://r-spatial.org/r/2018/10/25/ggplot2-sf.html target=_blank rel=noopener>ggplot2 puede dibujar el mapa</a>.</li><li><a href=https://r-charts.com/spatial/choropleth-map-ggplot2/ target=_blank rel=noopener>Más bibliotecas choropleth en ggplot2 (<code>giscoR</code>)</a>.</li></ul><h2 id=getting-polygons-of-all-countries-and-iso-3166-2-subdivisions-original><a href=#getting-polygons-of-all-countries-and-iso-3166-2-subdivisions-original alt>Getting polygons of all countries and ISO-3166-2 subdivisions (<a href=https://www.stackoverlflow.com/questions/23028/getting-polygons-of-all-countries-and-iso-3166-2-subdivisons target=_blank rel=noopener>original</a>)</a> <a href=# alt="Regresar al inicio">↑</a></h2><p>In order to do reverse geocoding look-ups to find a country (as ISO-3166-1) and the subdivision (as ISO-3166-2)
for given coordinates I am looking for a way to get all polygons of all countries and their subdivisions.</p><p>Reverse geocoding look-ups with Google Maps or other services either do not always return the country and subdivision (Google Maps),
or sometimes they are incorrect ( <a href=https://geonames.org target=_blank rel=noopener>https://geonames.org</a> ).
As I understand it all countries and subdivisions are available in the OpenStreetMap data,
but I do not know how to only retrieve the polygons</p><ul><li>no map data, no points of interest or cities are necessary,
only the outlines of all subdivisions with the given country and subdivision codes.
Then I can check myself if a given point is within any given polygon, or near it.</li></ul><p>Does anyone know how to retrieve this data from the OpenStreetMap data, or is there any other source for this data?</p><p>Maybe this site may have what you are looking for ??
<a href=http://www.gadm.org/ target=_blank rel=noopener>http://www.gadm.org/</a> and
<a href=http://www.gadm.org/country target=_blank rel=noopener>http://www.gadm.org/country</a></p><p>I&rsquo;ve checked out <a href=http://www.gadm.org/ target=_blank rel=noopener>http://www.gadm.org/</a> and was able to test it</p><ul><li>the provided data is really good, and most importantly,
the ISO 3166-2 codes are contained (usually in the HASC_1 column, sometimes in HASC_2 column).
Some manual processing is still necessary depending on what kind of details one wants,
but the source material seems great so far.</li></ul><p>@iquito: FYI those values in the HASC_* columns are <em>not</em> ISO3166,
they&rsquo;re a <a href=http://www.statoids.com/ihasc.html target=_blank rel=noopener>totally different thing</a>.</p><hr><p>Since you requested how to extract this data from OpenStreetMap:
theoretically you can use the <a href=http://wiki.openstreetmap.org/wiki/XAPI#Tag_Predicates target=_blank rel=noopener>XAPI</a>
to match <a href=https://wiki.openstreetmap.org/wiki/Boundaries target=_blank rel=noopener>boundary</a> descriptions.
E.g. using a query like this: <em>(warning, will take quite a while, so I&rsquo;m not formatting this as a link!)</em></p><p><code>https://www.overpass-api.de/api/xapi?way[bbox=2,49,7.5,54][boundary=administrative][admin_level=2]</code></p><p>The result will be a list of polygons, in this case denoting the boundaries of the Benelux countries.
You&rsquo;d probably have to repeat this for other bounding boxes, perhaps with overlap.
And for other levels. Lot of work. You&rsquo;d want a script for that.</p><p>Or download <a href=https://wiki.openstreetmap.org/wiki/Planet.osm target=_blank rel=noopener>Planet.osm</a>,
and simply use suitable <a href=https://wiki.openstreetmap.org/wiki/Frameworks target=_blank rel=noopener>OSM libraries</a>
or XML tools to locally extract the relevant data.</p><p>All of this will come without uniform ISO-3166-2 identifiers,
as far as I can tell, simply because that standard is not available for free.</p><hr><p>Other sources include <a href=http://www.unsalb.org/ target=_blank rel=noopener>http://www.unsalb.org/</a> and <a href=http://www.diva-gis.org/Data target=_blank rel=noopener>http://www.diva-gis.org/Data</a></p><p>You can find a script inspired by <code>MvG</code>&rsquo;s answer and a few examples here:</p><p><a href=https://github.com/laem/regions-topojson target=_blank rel=noopener>https://github.com/laem/regions-topojson</a></p><p>Sadly, not all geonames administrative relations are tagged with ISO-3166-2&mldr;</p></article></main></body></html>
<!doctype html><html lang=es-mx><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Gestionar secretos</title><link rel=stylesheet media=screen href=https://joshua.haase.mx/css/theme.min.2ee1317322f9eb9b2ef0a618d19b20e38c11f5f9c310751400a45db225dd2626.css integrity="sha256-LuExcyL565su8KYY0Zsg44wR9fnDEHUUAKRdsiXdJiY="><script src=https://hypothes.is/embed.js></script></head><body><main><article><h1>Gestionar secretos</h1><nav id=TableOfContents><ul><li><a href=#contexto>Contexto</a></li><li><a href=#amenazas>Amenazas</a></li><li><a href=#cómo-he-lidiado-con-el-problema-hasta-ahora>Cómo he lidiado con el problema hasta ahora</a></li><li><a href=#cómo-pienso-hacerlo-ahora>Cómo pienso hacerlo ahora</a></li><li><a href=#rotar-secretos-en-contenedores>Rotar secretos en contenedores</a></li><li><a href=#fuentes-de-información>Fuentes de información</a></li></ul></nav><h2 id=contexto><a href=#contexto alt>Contexto</a> <a href=# alt="Regresar al inicio">↑</a></h2><p>Mis computadoras usan disco cifrado y sé que si me roban mi compu mientras está apagada no pueden acceder a mi información.
Pero como uso ´pass´ y no me sé mis contraseñas podría perder el acceso a todas mis cuentas web.</p><p>Para eso, hice un procedimiento complicado para recuperar mis contraseñas que no actualicé al cambiar de servidor.
Y cuando se rompió mi computadora me di cuenta de que quedé sin acceso a mi respaldo.</p><p>Quiero implementar un protocolo automático para respaldar y recuperar mi información privada.
El punto clave es cómo compartir mi clave privada sin hacerla vulnerable.</p><h2 id=amenazas><a href=#amenazas alt>Amenazas</a> <a href=# alt="Regresar al inicio">↑</a></h2><ul><li><p>Si se sabe dónde está mi información podría hackear el servidor para recuperar mis contraseñas.</p><p>Para eso, la información que se sube al servidor debe estar cifrada por algún medio que sea seguro.</p></li><li><p>Suponiendo que perdí el acceso a todos mis equipos y respaldos de mi clave privada debería encontrar la manera de recuperar mi información.</p><p>Por eso el procedimiento para recuperar mis contraseñas debe ser público.</p></li><li><p>El repositorio donde he guardado hasta ahora las cosas muestra en claro los archivos, tendría que cifrarse previamente.</p><p>Podría usar un servicio de cifrado en backend para archivos de git, como <a href=https://spwhitton.name/tech/code/git-remote-gcrypt/ target=_blank rel=noopener>git-remote-gcrypt</a> o <a href=https://keybase.io/blog/encrypted-git-for-everyone target=_blank rel=noopener>keybase</a>.</p><p>Podría hacer rebase del historial cifrando lo que tenga que cifrarse, el historial ocupa 11MB.</p></li></ul><h2 id=cómo-he-lidiado-con-el-problema-hasta-ahora><a href=#c%c3%b3mo-he-lidiado-con-el-problema-hasta-ahora alt>Cómo he lidiado con el problema hasta ahora</a> <a href=# alt="Regresar al inicio">↑</a></h2><p>He intentado no compartir mis archivos secretos más que en mi computadora personal en la que confío y tiene disco cifrado.</p><p>Usando vcsh he versionado el trabajo pero no he hecho respaldos más que en mis discos duros externos que también están cifrados. Sin embargo, no tengo un procedimiento automático para actualizar el respaldo y los respaldos que tengo están retrasados.</p><ul><li><p><input checked disabled type=checkbox> Identificar los archivos que deben gestionarse con cuidado.</p><p>Los archivos sensibles se gestionan en el repositorio <code>id</code> de <code>vcsh</code>
en todas mis computadoras anteriores.</p></li><li><p><input checked disabled type=checkbox> Recuperar mi repositorio de contraseña</p><pre tabindex=0><code>vcsh init id
vcsh enter id
git remote add /mnt/joshpar/.config/vcsh/
git pull remote
</code></pre></li></ul><h2 id=cómo-pienso-hacerlo-ahora><a href=#c%c3%b3mo-pienso-hacerlo-ahora alt>Cómo pienso hacerlo ahora</a> <a href=# alt="Regresar al inicio">↑</a></h2><p>Alternativas:</p><ol><li>Publicar la de algún modo en un repositorio cifrado (git-crypt, keybase).</li></ol><ul><li><p><input checked disabled type=checkbox> Editar la versión maestra de mi repositorio de id para usar <code>git-crypt</code>
con una contraseña para permitir publicarlo de manera segura.</p><pre tabindex=0><code>git checkout --orphan safe-to-backup
git reset .
git commit --allow-empty -m &#39;root-commit: empty&#39;
git crypt init
sudo install -d -o x -g x /home/newuser

cat .git
gitdir: /home/x/.config/vcsh/repo.d/id.git/worktrees/newuser
</code></pre><p>Parece una buena idea pero hay que tomar en cuenta que
<a href=https://github.com/AGWA/git-crypt/#limitations target=_blank rel=noopener><code>git-crypt</code> no puede rotar llaves automáticamente</a>.
<a href=https://stackoverflow.com/a/56152033 target=_blank rel=noopener>Se pueden rotar llaves de <code>git-crypt</code> con este procedimiento</a>.</p></li><li><p><input disabled type=checkbox> Cifrar los archivos importantes en el historial de mi configuración.</p></li><li><p><input checked disabled type=checkbox> ¿Agregar la llave como archivo cifrado a mi repo?</p><p>En principio la clave privada tiene contraseña,
entonces debería estar cifrada.</p></li><li><p>☒ <del>Desactivar push en las demás ramas al usar ese repositorio.</del></p><p>No parece necesario porque todos los remotos de mi repositorio son locales.</p></li><li><p><input checked disabled type=checkbox> Subir el repositorio a un lugar público.</p></li></ul><p><a href=https://gitlab.com/xihh87/my-workstation/ title="Configuración de mi servidor." target=_blank rel=noopener>El procedimiento para recuperarla debe ser público y automatizado</a>,
de manera que pudiera recuperarla si no tuviera mi computadora ni mis respaldos
y que pueda actualizarlo con un comando.</p><h2 id=rotar-secretos-en-contenedores><a href=#rotar-secretos-en-contenedores alt>Rotar secretos en contenedores</a> <a href=# alt="Regresar al inicio">↑</a></h2><p><a href=https://www.hashicorp.com/resources/ephemeral-database-credentials-with-vault-and-terraform-at-bench-accounting target=_blank rel=noopener>Para gestionar secretos en aplicaciones,
se puede agregar un wrapper que solicite los secretos a Vault al inicio
y programar que el contenedor se vuelva a lanzar
en el momento en que expira la contraseña</a>.</p><h2 id=fuentes-de-información><a href=#fuentes-de-informaci%c3%b3n alt>Fuentes de información</a> <a href=# alt="Regresar al inicio">↑</a></h2><ul><li><p><a href=https://dzone.com/articles/storing-encrypted-credentials-in-git target=_blank rel=noopener>Guardar credenciales secretas en git</a>.</p></li><li><p><a href=https://embeddedartistry.com/blog/2018/3/15/safely-storing-secrets-in-git target=_blank rel=noopener>Guardar secretos de forma segura en git</a>.</p></li><li><p><a href=https://www.onwebsecurity.com/configuration/safely-storing-ansible-playbook-secrets.html target=_blank rel=noopener>Guardar secretos de <code>ansible-playbook</code></a>.</p></li><li><p><a href=https://devops.stackexchange.com/questions/3282/where-to-put-ansible-vault-password target=_blank rel=noopener>Dónde poner la contraseña de <code>ansible-vault</code></a>.</p></li><li><p><a href=https://tozny.com/blog/crypto-tools-for-devops/ target=_blank rel=noopener>Herramientas criptográficas para DevOps</a>.</p></li><li><p><a href=https://www.andreagrandi.it/2017/09/30/configuring-offline-gnupg-masterkey-subkeys-on-yubikey/ target=_blank rel=noopener>Configurar masterkey de GPG en YubiKey</a>.</p></li></ul></article></main></body></html>
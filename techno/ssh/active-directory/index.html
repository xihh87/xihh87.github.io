<!doctype html><html lang=es-mx><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Usar login institucional para servidores</title><link rel=stylesheet media=screen href=https://joshua.haase.mx/css/theme.min.2ee1317322f9eb9b2ef0a618d19b20e38c11f5f9c310751400a45db225dd2626.css integrity="sha256-LuExcyL565su8KYY0Zsg44wR9fnDEHUUAKRdsiXdJiY="><script src=https://hypothes.is/embed.js></script></head><body><main><article><h1>Usar login institucional para servidores</h1><nav id=TableOfContents><ul><li><a href=#propuestas-inicio-de-sesión-único-para-equipos-de-cómputo>Propuestas: inicio de sesión único para equipos de cómputo</a></li><li><a href=#contexto>Contexto</a><ul><li><a href=#los-usuarios-se-generan-manualmente>Los usuarios se generan manualmente</a></li></ul></li><li><a href=#posibles-implementaciones>Posibles implementaciones</a><ul><li><a href=#usar-active-directory-como-almacén-de-llaves-criptográficas-públicas-y-sssd-para-solicitarlas>Usar Active Directory como almacén de llaves criptográficas públicas y SSSD para solicitarlas</a></li><li><a href=#usar-kerberos-para-autenticar-con-active-directory>Usar Kerberos para autenticar con Active Directory</a></li><li><a href=#usar-pam-para-autenticar-con-active-directory>Usar PAM para autenticar con Active Directory</a></li><li><a href=#sincronizar-claves-desde-github-o-gitlab>Sincronizar claves desde Github o GitLab</a></li><li><a href=#comprar-un-servicio-externo>Comprar un servicio externo</a></li><li><a href=#usar-active-directory-como-ca-para-ssh-y-kerberos-para-validar-las-claves>Usar Active Directory como CA para SSH y Kerberos para validar las claves</a></li><li><a href=#usar-vault-como-ca-para-gestionar-ssh-y-active-directory-como-proveedor-de-identidad>Usar Vault como CA para gestionar SSH y Active Directory como proveedor de identidad</a></li><li><a href=#usar-azure-cli>Usar Azure cli</a></li><li><a href=#usar-un-servicio-web-oauth>Usar un servicio web OAuth</a></li></ul></li><li><a href=#prototipo>Prototipo</a></li><li><a href=#consideraciones-en-la-selección-de-alternativa>Consideraciones en la selección de alternativa</a></li></ul></nav><h2 id=propuestas-inicio-de-sesión-único-para-equipos-de-cómputo><a href=#propuestas-inicio-de-sesi%c3%b3n-%c3%banico-para-equipos-de-c%c3%b3mputo alt>Propuestas: inicio de sesión único para equipos de cómputo</a> <a href=# alt="Regresar al inicio">↑</a></h2><p>Para las <em>Coordinaciones</em> de <em>Ciencia de Datos</em> e <em>Ingeniería Electrónica</em>
que administran los usuarios de servidores y cómputo en laboratorio manualmente;
se propone configurar SSH para permitir el acceso usando Active Directory.
A diferencia del proceso manual este proyecto:</p><ul><li>permitiría a los estudiantes acceder inmediatamente a los recursos de las coordinaciones,</li><li>aprovecharía el procedimiento de rotación de contraseñas de las cuentas Ibero,</li><li>eliminaría el acceso de los estudiantes graduados o en baja inmediatamente,</li><li>aprovecharía la gestión de Directorio Activo por parte de la <em>Coordinación de Cómputo Académico</em>, eliminando re-trabajo,</li><li>mantendría la consistencia entre los usuarios
que pueden acceder a los recursos del
<em>Departamento de Estudios en Ingeniería para la Innovación</em>.</li></ul><h2 id=contexto><a href=#contexto alt>Contexto</a> <a href=# alt="Regresar al inicio">↑</a></h2><p>Infraestructura en cuestión:</p><p><figure><img src=https://files.haase.mx/ibero/servicios_admistrados_por_joshua_haase_en_la_universidad_iberoamericana.svg></figure></p><h3 id=los-usuarios-se-generan-manualmente><a href=#los-usuarios-se-generan-manualmente alt>Los usuarios se generan manualmente</a> <a href=# alt="Regresar al inicio">↑</a></h3><p>Proceso para generar usuarios en <code>antares</code>:</p><p><figure><img src=https://files.haase.mx/ssh_ad/solicitar-usuarios.svg></figure></p><p>Proceso para generar usuarios en <code>sirio</code>, <code>vega</code>:</p><embed type=image/svg+xml src=https://files.haase.mx/ssh_ad/usuarios-gcd.svg><h2 id=posibles-implementaciones><a href=#posibles-implementaciones alt>Posibles implementaciones</a> <a href=# alt="Regresar al inicio">↑</a></h2><p>Dado que en <em>Cómputo Académico</em> cada semestre
se revisa que Active Directory (AD) contenga únicamente
los registros de estudiantes activos,
esa información puede aprovecharse:</p><embed type=image/svg+xml src=https://files.haase.mx/ssh_ad/inicio_de_sesi%c3%b3n_%c3%banico_para_ciencia_de_datos.svg><p>Como alternativa, podría usarse el Azure Active Directory
que administra la <em>Dirección de Información y Tecnología</em>.</p><p>Estos son los mecanismos con que <code>sshd</code> podría conectarse con el <code>AD</code>:</p><embed type=image/svg+xml src=https://files.haase.mx/ssh_ad/posibilidades.svg><p>Y a continuación opciones de implementación:</p><h3 id=usar-active-directory-como-almacén-de-llaves-criptográficas-públicas-y-sssd-para-solicitarlas><a href=#usar-active-directory-como-almac%c3%a9n-de-llaves-criptogr%c3%a1ficas-p%c3%bablicas-y-sssd-para-solicitarlas alt>Usar Active Directory como almacén de llaves criptográficas públicas y SSSD para solicitarlas</a> <a href=# alt="Regresar al inicio">↑</a></h3><embed type=image/svg+xml src=https://files.haase.mx/ssh_ad/opci%c3%b3n_1.svg><embed type=image/svg+xml src=https://files.haase.mx/ssh_ad/o1-secuencia.svg><ul><li><a href=https://www.ratsarc.com/post/linux-ssh-key-password-auth-for-users-stored-in-active-directory target=_blank rel=noopener>Configurar acceso a Active Directory usando SSSD</a>.</li><li><a href=file:///home/x/web/medium.com/techish-cloud/linux-user-ssh-authentication-with-sssd-ldap-without-joining-domain-9151396d967d>Configurar SSH para autenticar por LDAP sin unirse al dominio</a>.</li><li><a href=https://www.linuxquestions.org/questions/linux-enterprise-47/logging-in-via-ssh-while-authenticating-against-active-directory-618885/ target=_blank rel=noopener>Configurar PAM para permitir acceso por Active Directory</a>.</li><li><a href=https://www.saotn.org/retrieve-ssh-public-key-from-active-directory-for-ssh-authentication/ target=_blank rel=noopener>Configurar AD como fuente de claves SSH usando <code>AuthorizedKeysCommand</code></a>
(<a href=https://techwolf12.nl/blog/ssh-authentication-ldap target=_blank rel=noopener>Guía techwolf</a>, <a href=https://serverfault.com/questions/653792/ssh-key-authentication-using-ldap target=_blank rel=noopener>serverfault</a>).</li><li><a href=https://super-unix.com/ubuntu/ubuntu-ssh-with-ldap-authentication-activedirectory-and-ssh-keys-stored-in-ad/ target=_blank rel=noopener>Configurar SSH con autenticación por LDAP</a>.</li></ul><h3 id=usar-kerberos-para-autenticar-con-active-directory><a href=#usar-kerberos-para-autenticar-con-active-directory alt>Usar Kerberos para autenticar con Active Directory</a> <a href=# alt="Regresar al inicio">↑</a></h3><ul><li><a href=https://www.dalemacartney.com/2012/07/06/how-to-quickly-and-easily-add-a-red-hat-enterprise-linux-6-system-to-microsoft-active-directory/ target=_blank rel=noopener>Configurar el sistema en Active Directory</a>
y <a href=https://www.dalemacartney.com/2013/08/30/single-sign-on-sso-with-secure-shell-ssh/ target=_blank rel=noopener>delegar autenticación de SSH usando <code>GSSAPIAuthentication</code> y <code>GSSAPIDelegateCredentials</code></a>
(<a href=https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/windows_integration_guide/sssd-ad target=_blank rel=noopener>Guía Red Hat</a>, troubleshooting: <a href=https://serverfault.com/questions/762194/ssh-login-using-active-directory-credentials target=_blank rel=noopener>serverfault</a>, <a href=https://www.beyondtrust.com/docs/ad-bridge/how-to/troubleshoot/logon/troubleshoot-ssh-sso.htm target=_blank rel=noopener>beyondtrust</a>).</li></ul><h3 id=usar-pam-para-autenticar-con-active-directory><a href=#usar-pam-para-autenticar-con-active-directory alt>Usar PAM para autenticar con Active Directory</a> <a href=# alt="Regresar al inicio">↑</a></h3><ul><li><p><input checked disabled type=checkbox> <a href=https://tldp.org/HOWTO/LDAP-HOWTO/ target=_blank rel=noopener>Configurar servidor LDAP</a> (Este sería el AD).</p></li><li><p><input disabled type=checkbox> <a href=https://www.linux.com/news/linux-ldap-authentication/ target=_blank rel=noopener>Configurar PAM para usar LDAP</a>
(<a href=https://docs.oracle.com/en/cloud/paas/identity-cloud/uaids/configure-linux-pam-module-using-sssd.html target=_blank rel=noopener>Guía oracle</a>, <a href=https://community.cloudera.com/t5/Community-Articles/How-PAM-NSS-SSD-work-together-on-Linux-OS/ta-p/247879 target=_blank rel=noopener>diagramas</a>).</p></li><li><p><input disabled type=checkbox> <a href=https://www.cyberciti.biz/tips/howto-configure-sshd-to-use-openldap-server.html target=_blank rel=noopener>Configurar SSH para usar <code>PAMAuthenticationViaKbdInt</code></a>.</p><p>(<a href=https://stackoverflow.com/questions/37603490/bypass-ldap-pam-authentication-when-ssh-as-local-user target=_blank rel=noopener>bypass stackoverflow</a>, <a href=https://community.oracle.com/tech/apps-infra/discussion/1909247/ssh-ldap-authentication target=_blank rel=noopener>ejemplo <code>pam.conf</code></a>).
(<a href=https://hostingultraso.com/help/ubuntu/ubuntu-server-logins-ldap target=_blank rel=noopener>ejemplo en ubuntu</a>,
<a href=https://techdocs.broadcom.com/us/en/ca-enterprise-software/it-operations-management/unified-infrastructure-management/20-3/installing/optional-post-installation-tasks/enable-login-with-ldap.html target=_blank rel=noopener>otro ejemplo</a>
<a href=https://docs.sciencelogic.com/latest/Content/Web_Install_Configure/AD_LDAP/ad_ldap_authenticate_example.htm target=_blank rel=noopener>guía ScienceLogic</a>,
<a href=https://help.useresponse.com/knowledge-base/article/using-ldap-as-a-single-sign-on target=_blank rel=noopener>uid mapping</a>).
Para este caso,
<a href=https://connect2id.com/products/ldapauth/auth-explained target=_blank rel=noopener>se puede utilizar <code>bind</code> para autenticar</a>
y <a href=https://stackoverflow.com/questions/37603490/bypass-ldap-pam-authentication-when-ssh-as-local-user target=_blank rel=noopener>configurar para usar cuenta local si existe</a>.</p></li></ul><h3 id=sincronizar-claves-desde-github-o-gitlab><a href=#sincronizar-claves-desde-github-o-gitlab alt>Sincronizar claves desde Github o GitLab</a> <a href=# alt="Regresar al inicio">↑</a></h3><ul><li><a href=https://github.com/samber/sync-ssh-keys target=_blank rel=noopener>Usar claves desde Github</a>.</li></ul><h3 id=comprar-un-servicio-externo><a href=#comprar-un-servicio-externo alt>Comprar un servicio externo</a> <a href=# alt="Regresar al inicio">↑</a></h3><ul><li><a href=https://www.ezeelogin.com/kb/article/how-to-use-the-ldap-password-as-the-security-code-on-user-login-in-ssh-485.html target=_blank rel=noopener>Usar <code>ezeelogin</code> para usar AD</a>.</li></ul><h3 id=usar-active-directory-como-ca-para-ssh-y-kerberos-para-validar-las-claves><a href=#usar-active-directory-como-ca-para-ssh-y-kerberos-para-validar-las-claves alt>Usar Active Directory como CA para SSH y Kerberos para validar las claves</a> <a href=# alt="Regresar al inicio">↑</a></h3><ul><li><input disabled type=checkbox> <a href=https://engineering.fb.com/2016/09/12/security/scalable-and-secure-access-with-ssh/ target=_blank rel=noopener>Agregar al Active Directory como Certificate Authority</a>
en la configuración de SSH
y <a href=https://blog.laslabs.com/2016/08/storing-ssh-keys-in-active-directory/ target=_blank rel=noopener>distribuir llaves privadas firmadas con un certificado desde el AD</a>.</li></ul><h3 id=usar-vault-como-ca-para-gestionar-ssh-y-active-directory-como-proveedor-de-identidad><a href=#usar-vault-como-ca-para-gestionar-ssh-y-active-directory-como-proveedor-de-identidad alt>Usar Vault como CA para gestionar SSH y Active Directory como proveedor de identidad</a> <a href=# alt="Regresar al inicio">↑</a></h3><ul><li><p><input disabled type=checkbox> Configurar Active Directory como <del>fuente de secretos</del></p><p>(<a href=https://stackoverflow.com/questions/71634317/hashicorp-vault-sso-authentication-using-azure-active-directory-terraform target=_blank rel=noopener>No respondido en Stack Overflow</a>.)</p></li><li><p><input disabled type=checkbox> <a href=https://developer.hashicorp.com/vault/docs/auth/jwt/oidc-providers/azuread target=_blank rel=noopener>Configurar Active Directory como proveedor de identidad de Vault</a></p></li><li><p><input disabled type=checkbox> Configurar Vault como CA de SSHd</p></li><li><p><input disabled type=checkbox> Los usuarios se autentican con Vault.</p><ul><li><input disabled type=checkbox> <a href=https://developer.hashicorp.com/vault/docs/secrets/ssh/signed-ssh-certificates target=_blank rel=noopener>Los usuarios usan <code>vault write</code> para generar clave</a>.</li><li><input disabled type=checkbox> <a href=https://developer.hashicorp.com/vault/docs/secrets/ssh/dynamic-ssh-keys target=_blank rel=noopener>Los usuarios generan claves SSH dinámicas</a></li></ul></li></ul><h3 id=usar-azure-cli><a href=#usar-azure-cli alt>Usar Azure cli</a> <a href=# alt="Regresar al inicio">↑</a></h3><ul><li>¿<a href=https://learn.microsoft.com/en-us/azure/active-directory/fundamentals/auth-ssh target=_blank rel=noopener>Usar <code>azure-cli</code> para gestionar la autenticación</a>?
(<a href=https://ubuntu.com/tutorials/using-azure-ad-to-manage-ssh-logins-to-ubuntu#1-overview target=_blank rel=noopener>Guía ubuntu</a>).</li></ul><h3 id=usar-un-servicio-web-oauth><a href=#usar-un-servicio-web-oauth alt>Usar un servicio web OAuth</a> <a href=# alt="Regresar al inicio">↑</a></h3><ul><li><a href=https://www.uncinc.nl/en/news/our-solution-to-employee-authentication-using-open-standards target=_blank rel=noopener>Configurar <code>LDAP</code> + <code>OAuth2</code></a>.</li></ul><h2 id=prototipo><a href=#prototipo alt>Prototipo</a> <a href=# alt="Regresar al inicio">↑</a></h2><p>Si se quisiera hacer una maqueta,
se podría <a href='https://betterprogramming.pub/ldap-docker-image-with-populated-users-3a5b4d090aa4?gi=3bc8462a5805' target=_blank rel=noopener>usar un LDAP pre-llenado</a>
(<a href=https://hub.docker.com/r/rroemhild/test-openldap/ target=_blank rel=noopener>docker pre-llenado</a>)
y una imagen que implemente la configuración de SSH.</p><h2 id=consideraciones-en-la-selección-de-alternativa><a href=#consideraciones-en-la-selecci%c3%b3n-de-alternativa alt>Consideraciones en la selección de alternativa</a> <a href=# alt="Regresar al inicio">↑</a></h2><ul><li><p>El sistema debe ser simple de usar</p></li><li><p>Las claves públicas son más seguras que las contraseñas</p></li><li><p>Usar caché local de configuración podría dificultar cambios de contraseña</p></li><li><p>La conexión con Active Directory podría representar un punto único de fallo</p></li><li><p>El sistema debe ser fácil de implementar</p></li></ul></article></main></body></html>